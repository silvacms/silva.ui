(function($,infrae){var NotificationManager=function(smi,options){var defaults=($(options.notifications.selector),{themeState:"feedback",life:options.notifications.life,speed:void 0===options.notifications.speed&&"normal"||options.notifications.speed}),default_notify=function(message){var options=$.extend({},defaults);"error"==message.category&&(options.themeState="error"),$.jGrowl(message.message,options)};$(document).on("click","#jGrowl",function(event){$(this).jGrowl("close"),event.stopPropagation(),event.preventDefault()});var api={notify:default_notify,notifies:function(messages){infrae.utils.each(messages,api.notify)},page:function(data){return void 0!=data.notifications&&infrae.utils.each(data.notifications,api.notify),null},error:function(data){return void 0!=data.notifications&&infrae.utils.each(data.notifications,api.notify),null}};if(!options.notifications.standard&&window.webkitNotifications){var native_api,using_chrome=function(){return navigator.userAgent.indexOf("Chrome")>-1?!0:!1}();native_api=using_chrome?window.webkitNotifications:window.Notification;var is_api_enabled=function(now){var status;if(status=using_chrome?native_api.checkPermission():native_api.permission,0==status||"granted"===status)return!0;if(1==status||"default"===status)try{return native_api.requestPermission(function(){}),now===!0}catch(error){return!1}return!1};is_api_enabled(!0)&&$.extend(api,{notify:function(message){if(is_api_enabled(!1)){var notification;if(notification=using_chrome?native_api.createNotification("",message.message,""):new Notification("",{body:message.message}),options.notifications.life){var close_after=function(){setTimeout(function(){notification.cancel()},options.notifications.life)};using_chrome?notification.ondisplay=close_after:notification.onshow=close_after}notification.show()}else default_notify(message)}})}return $(document).bind("refresh-feedback-smi",function(){$.getJSON(options.notifications.url,function(messages){messages.notifications&&api.notifies(messages.notifications)})}),$(document).bind("notify-feedback-smi",function(event,data){"array"==typeof data?api.notifies(data):api.notify(data)}),api};$.extend(infrae.smi.plugins,{notifications:NotificationManager})})(jQuery,infrae);