(function($,infrae){var NotificationManager=function(smi,options){var defaults=($(options.notifications.selector),{themeState:"feedback",speed:void 0===options.notifications.speed&&"normal"||options.notifications.speed}),default_notify=function(message){var options=$.extend({},defaults);"error"==message.category&&(options.themeState="error"),$.jGrowl(message.message,options)};$("#jGrowl").live("click",function(event){$(this).jGrowl("close"),event.stopPropagation(),event.preventDefault()});var api={notify:default_notify,notifies:function(messages){infrae.utils.each(messages,api.notify)},page:function(data){return void 0!=data.notifications&&infrae.utils.each(data.notifications,api.notify),null},error:function(data){return void 0!=data.notifications&&infrae.utils.each(data.notifications,api.notify),null}};if(!options.notifications.standard&&window.webkitNotifications){var native_api=window.webkitNotifications;$.extend(api,{notify:function(message){var status=native_api.checkPermission();if(0==status){var notification=native_api.createNotification("",message.message,"");message.autoclose&&(notification.ondisplay=function(){setTimeout(function(){notification.cancel()},message.autoclose)}),notification.show()}else 1==status&&native_api.requestPermission(),default_notify(message)}})}return $(document).bind("refresh-feedback-smi",function(){$.getJSON(options.notifications.url,function(messages){messages.notifications&&api.notifies(messages.notifications)})}),$(document).bind("notify-feedback-smi",function(event,data){"array"==typeof data?api.notifies(data):api.notify(data)}),api};$.extend(infrae.smi.plugins,{notifications:NotificationManager})})(jQuery,infrae);