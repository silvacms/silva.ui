(function(e,t,n){e.ajaxSetup({cache:!1});var r={HTMLResourceManager:function(t){var n={css:[],js:[]},r=t.get(0),i=r.getElementsByTagName("head")[0],s={is_js_loaded:function(t){return e.inArray(t,n.js)>-1},is_css_loaded:function(t){return e.inArray(t,n.css)>-1},load_js:function(t){var o=e.Deferred();if(!s.is_js_loaded(t)){var u=r.createElement("script");return u.async="async",u.type="text/javascript",u.readyState?u.onreadystatechange=function(){if(u.readyState=="loaded"||u.readyState=="complete")u.onreadystatechange=null,o.resolve()}:u.onload=function(){o.resolve()},u.src=t,i.appendChild(u),n.js.push(t),o}return o.resolve()},load_css:function(e){if(!s.is_css_loaded(e)){var t=r.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,i.appendChild(t),n.css.push(e)}}};return t.ready(function(){e("script").each(function(){var t=e(this).attr("src");t!=undefined&&!s.is_js_loaded(t)&&n.js.push(t)}),e("link").each(function(){var t=e(this);if(t.attr("rel")=="stylesheet"&&t.attr("type")=="text/css"){var r=t.attr("href");r!=undefined&&!s.is_css_loaded(r)&&n.css.push(r)}})}),s}},i={},s=function(t,r,s,o,u){var a={$content:t,data:r};e.extend(a,s.apply(t,o));var f=function(n){a.template_append||(t.triggerHandler("cleanup-infrae-views"),(a.cleanup||a.iframe)&&t.one("cleanup-infrae-views",function(){a.cleanup&&a.cleanup(),a.iframe&&(e(window).unbind("resize.infrae-views-iframe"),e(window).unbind("workspace-resize-smi.infrae-views-iframe"),t.removeClass("iframe-view"))}));var r=e.Deferred(),i=t,s=function(){u!=undefined?r.rejectWith(a,u):r.resolveWith(a)},o=function(){var e=null;if(a.render!=undefined){e=a.render(i);if(e&&e.promise){e.promise().done(s);return}}s()};if(a.iframe){if(a.template_append)throw{message:"Cannot use iframe and template_append together"};var f=e('<iframe src="">'),l=function(){f.height(t.innerHeight()),f.width(t.innerWidth())};l(),e(window).bind("resize.infrae-views-iframe",l),e(window).bind("workspace-resize-smi.infrae-views-iframe",l),t.addClass("iframe-view"),t.html(f);var c=f.get(0).contentWindow,h=c.document;a.$window=e(c),a.$document=e(h);if(n!==undefined){a.ready=e.Deferred();var p=function(){a.ready.resolve(a)};n.indexOf("<html")<0&&n.indexOf("<HTML")<0&&(n="<html><body>"+n+"</body></html>"),h.write(n),h.close(),h.readyState=="complete"?p():c.addEventListener?c.addEventListener("load",p,!1):c.attachEvent("onload",p)}}else n!==undefined&&(a.template_append?(i=e(n),t.append(i)):t.html(n));return o(),r.promise()};return function(){var t=undefined,s=a.template_data&&r.jsont_url||a.jsont_url;if(s){if(!a.template_nocache){t=i[s];if(t!==undefined)return f(t.expand(a))}return e.ajax({type:"GET",url:s}).pipe(function(e){var t=new n.Template(e,{});return i[s]=t,f(t.expand(r))})}var o=a.template_data&&r.html_url||a.html_url;if(o){if(!a.template_nocache){t=i[o];if(t!==undefined)return f(t)}return e.ajax({type:"GET",url:o}).pipe(function(e){return i[o]=e,f(e)})}var u=a.template_data&&r.jsont||a.jsont;if(u!==undefined)return t=i[u],t===undefined&&(t=new n.Template(u,{}),i[u]=t),f(t.expand(a));var l=a.template_data&&r.html||a.html;return l!==undefined?f(l):f()}};e.extend(r,{Registry:function(){var n={},r=0,i=function(r,i,o){var u=o.ifaces||t.interfaces.implemented_by(i),a=n[o.name],f=null,l=[r,i].concat(o.args),c=o.reject;if(a)for(var h=0;h<u.length;h++){var p=a[u[h]];if(p&&p.length){f=s(r,i,p[0].factory,l,c);break}}return f!=null?f():(window.console&&console.log&&console.log("failed view lookup for options",o,"and",i),e.Deferred().reject({status:604}))},o=function(r,i,o){var u=n[o.name];if(u==undefined)return[];var a=o.ifaces||t.interfaces.implemented_by(i),f=[],l=[],c=[r,i].concat(o.args),h=o.reject;return t.utils.each(a,function(n){var o=u[n];o&&t.utils.each(o,function(t){if(e.inArray(t.__view_uid__,f)<0){f.push(t.__view_uid__);if(t["available"]!=undefined&&!t.available.apply(t,c))return;l.push([t.order,s(r,i,t.factory,c,h)])}})}),l.sort(function(e,t){return e[0]-t[0]}),e.each(l,function(e,t){t[1]()}),null},u=function(t,n,r){return e.ajax({type:"GET",url:n,dataType:"json"}).pipe(function(e){return i(t,e,r)})},a={register:function(e){e.name==undefined&&(e.name="default"),e.order==undefined&&(e.order=0),e.__view_uid__=r.toString(),r+=1;var i=function(e,t){n[e.name]||(n[e.name]={}),n[e.name][t]||(n[e.name][t]=[]),n[e.name][t].unshift(e)};e.ifaces?t.utils.each(e.ifaces,function(t){i(e,t)}):i(e,e.iface||"object")},render:function(e,t){t.name||(t.name="default");if(t.data)return i(e,t.data,t);if(t.every)return o(e,t.every,t);if(t.url)return u(e,t.url,t);throw{message:"Missing required options"}}};return a}});var o=r.Registry();e.extend(r,{view:function(e){o.register(e)},render:function(e,t){return o.render(e,t)}}),e.fn.render=function(t){return o.render(e(this),t)},t.views=r})(jQuery,infrae,jsontemplate);