(function(e,t){t.views.view({iface:"preview",name:"content",factory:function(e,t,n){var r=!1,i=0,s=0,o=0,u=0,a=function(e){e.height(Math.min(o,i)),e.width(Math.min(u,s))};return{template_data:!0,template_nocache:!0,iframe:!0,resize_iframe:function(e,t){return u=e,o=t,r?(a(this.$iframe),!0):!1},set_resolution:function(e,t){r=!0,i=t,s=e,a(this.$iframe)},clear_resolution:function(){r=!1,this.$iframe.trigger("resize")},cleanup:function(){e.empty()}}}}),t.views.view({iface:"preview",name:"toolbar",factory:function(t,n,r,i){var s=n.menu.actions,o=r.options.preview?r.options.preview.resolutions:[],u=s&&s.entries.length;return{jsont:'{.section have_actions}<div class="actions content-toolbar"><ol></ol></div>{.end}{.section resolutions}<div class="view-toolbar resolution-preview"><select>{.repeated section @}<option value={resolution|htmltag}>{name}</option>{.end}</select></div>{.end}',have_actions:u,resolutions:o,render:function(){u&&t.find(".content-toolbar ol").render({data:s}),o.length&&t.find(".resolution-preview select").on("change",function(){var t=e(this).attr("value"),n=t.match(/(\d*)x(\d*)/);n?i.set_resolution(n[1],n[2]):i.clear_resolution()})},cleanup:function(){t.empty()}}}}),t.views.view({iface:"redirect",factory:function(e,t,n){return{render:function(){n.open_screen(t.path,t.screen)}}}});var n=new jsontemplate.Template('<div id="smi-text"><div class="smi-text-content">{html}</div></div>',{});t.views.view({iface:"text-overlay",factory:function(t,r,i){var s=e(n.expand(r)),o=e('<div class="ui-widget-overlay"></div>'),u=function(t){if(!e(t.target).is("a"))return s.remove(),o.remove(),!1};return{render:function(){o.click(u),s.click(u),e("body").append(o),e("body").append(s)}}}}),t.views.view({iface:"view",factory:function(e,t,n){return{render:function(){window.open(t.url)}}}}),t.views.view({iface:"message",factory:function(e,n,r){return{render:function(){return t.ui.ConfirmationDialog({title:n.title,message:n.message,not_cancellable:!0})}}}}),t.views.view({iface:"title",factory:function(n,r,i){return{jsont:'<ins class="icon"></ins>{data.title|html}',render:function(){var s="Silva";i.options.theme&&i.options.theme.name&&(s=i.options.theme.name),t.ui.icon(n.children("ins"),r.icon),e.browser.msie||e("head > title").html(s+" - "+r.title)}}}}),t.views.view({iface:"menu",factory:function(n,r){var i=n.hasClass("tabs"),s=e([]),o=function(t,n){var r=e("<li><a></a></li>"),u=r.children("a");i&&(n?(t.screen?u.addClass("top-screen"):u.addClass("top-label"),u.addClass("top-entry"),r.addClass("top-level")):r.addClass("sub-level")),t.name?u.html("<span>"+t.name+"</span>"):t.logo&&u.html('<ins class="tab-logo '+t.logo+'"/>'),t.screen?(u.addClass("open-screen"),u.attr("rel",t.screen)):t.action?(u.addClass("open-action"),u.attr("rel",t.action)):t.url&&(u.attr("href",t.url),t.target&&u.attr("target",t.target));if(t.icon){var a="tab-icon";t.action&&(a="action-icon"),u.addClass("ui-state-default"),u.prepend('<div class="'+a+'"><ins class="ui-icon ui-icon-'+t.icon+'"></ins></div>')}t.active&&u.addClass("active"),t.description&&u.attr("title",t.description),t.accesskey&&u.attr("accesskey",t.accesskey),t.trigger&&u.addClass(t.trigger);if(t.entries){var f=e('<ol class="subtabs"></ol>'),l=e('<div class="subtab-icon"><ins></ins></div>'),c=t.screen&&n?l:u,h=function(t){var n=[],r=[],i=f.get(0);s.each(function(){this===i&&!t||e.contains(this,i)?n.push(this):r.push(this)}),e(r).fadeOut("fast"),s=e(n),t?s=e(n):s=e(n).add(i)};e.each(t.entries,function(e,t){f.append(o(t))}),f.bind("mouseleave",function(){h(!0)}),f.bind("click",function(){h(!0)}),c.bind(n?"click":"mouseenter",function(){var t=u.offset().left,r=f.width(),i=e(document).width();if(!n){var s=u.width();t+s+r<i?f.css("left",s):f.css("right",r-5),f.css("top",0)}else t+r<i?f.css("left",0):f.css("right",0);return h(!1),f.show(),!1}),u.prepend(l),r.append(f)}return r};return{render:function(){e.each(r.entries,function(e,t){n.append(o(t,!0))}),n.tipsy({delegate:"a"}),t.ui.selection.disable(n),i||n.children("li:last").addClass("last-action")},cleanup:function(){n.unbind("open-menu"),n.unbind(".tipsy"),n.empty()}}}}),t.views.view({iface:"object",name:"header",factory:function(t,n,r,i,s){var o=function(e,t){t?((e.is("ol")?e:e.find("ol")).render({data:t}),e.show()):e.hide()},u=function(e,t,n){o(e.children(".user-menu"),t.user);if(!n)o(e.find(".view-actions"),t.view),o(e.children(".content-tabs"),t.content),o(e.find(".compact-tabs"),undefined);else{var r=[];t.content&&(r=r.concat(t.content.entries)),t.view&&(r=r.concat(t.view.entries)),o(e.find(".view-actions"),undefined),o(e.children(".content-tabs"),undefined),o(e.find(".compact-tabs"),{ifaces:["menu"],entries:[{logo:"tab-options",entries:r}]})}};return{render:function(){var o=t.children(".metadata"),a=t.find("a.parent"),f=t.hasClass("compact-header");o.children("h2").render({data:n.title,args:[r,s]}),o.children("#content-url").attr("href",i.expand({path:n.path})),u(o,n.menu,f),t.find(".admin-actions").tipsy({delegate:"a"}),t.children(".toolbar").render({data:n,name:"toolbar",args:[r,s]}),n.up!=null?(a.attr("href",n.up||"/"),a.attr("rel",r.opened.tab),a.removeClass("ui-state-disabled"),a.addClass("ui-state-default")):(a.addClass("ui-state-disabled"),a.removeClass("ui-state-default")),e(window).bind("fullscreen-resize-smi.default-header",function(e,t){u(o,n.menu,t.active)})},cleanup:function(){t.find(".admin-actions").unbind(".tipsy"),e(window).unbind("fullscreen-resize-smi.default-header")}}}}),t.views.view({iface:"object",name:"toolbar",factory:function(e,t){var n=t.menu.actions,r=n&&n.entries.length;return{jsont:'{.section have_actions}<div class="actions content-toolbar"><ol></ol></div>{.end}',have_actions:r,render:function(){r&&e.find(".content-toolbar ol").render({data:n})},cleanup:function(){e.empty()}}}})})(jQuery,infrae);