(function(infrae,$){var module={},dialog_options={maxFactor:.8,minFactor:0,threshold:15,maxWidth:0,maxHeight:0,minWidth:0,maxHeight:0,position:["center","center"]};$.extend(module,{icon:function($content,icon){0>icon.indexOf(".")?$content.addClass(icon):$content.attr("style","background:url("+icon+") no-repeat center center;")},selection:{disable:function($content){return $content.disableSelection()},enable:function($content){return $content.enableSelection()}},ShowDialog:function($dialog,options){var $window=$(window),$widget=$dialog.dialog("widget");if(void 0!==options)for(var name in dialog_options)void 0===options[name]&&(options[name]=dialog_options[name]);else options=dialog_options;var resize=function(initial){var window_width=$window.width(),window_height=$window.height(),widget_width=$widget.width(),widget_height=$widget.height(),min_width=Math.ceil(window_width*options.minFactor),min_height=Math.ceil(window_height*options.minFactor),max_width=Math.ceil(window_width*options.maxFactor),max_height=Math.ceil(window_height*options.maxFactor),popup_position=$widget.position(),need_reposition=initial===!0,changed_size=!1;options.maxWidth&&(max_width=Math.min(options.maxWidth,max_width)),options.maxHeight&&(max_height=Math.min(options.maxHeight,max_height)),options.minWidth&&(min_width=Math.max(options.minWidth,min_width)),options.minHeight&&(min_height=Math.max(options.minHeight,min_height)),min_height>widget_height?($dialog.dialog("option","height",min_height),widget_height=min_height,changed_size=!0,min_height>max_height&&(max_height=min_height)):widget_height>max_height&&($dialog.dialog("option","height",max_height),widget_height=max_height,changed_size=!0),popup_position.top&&0>window_height-(popup_position.top+widget_height+options.threshold)&&(need_reposition=!0),min_width>widget_width?($dialog.dialog("option","width",min_width),widget_width=min_width,changed_size=!0,min_width>max_width&&(max_width=min_width)):widget_width>max_width&&($dialog.dialog("option","width",max_width),widget_width=max_width,changed_size=!0),popup_position.left&&0>window_width-(popup_position.left+widget_width+options.threshold)&&(need_reposition=!0),$dialog.dialog("option","maxHeight",max_height),$dialog.dialog("option","maxWidth",max_width),$dialog.dialog("option","minHeight",min_height),$dialog.dialog("option","minWidth",min_width),need_reposition&&$dialog.dialog("option","position",options.position),changed_size&&$dialog.trigger("infrae-ui-dialog-resized",{height:widget_height,width:widget_width})},handler=function(event){event.target===window?setTimeout(resize,0):event.target===$widget.get(0)&&$dialog.trigger("infrae-ui-dialog-resized",{height:$widget.height(),width:$widget.width()})};$window.bind("resize.infrae-ui-dialog",handler),$dialog.one("dialogclose",function(){$window.unbind("resize.infrae-ui-dialog",handler),$dialog.unbind("infrae-ui-dialog-resize")}),$dialog.bind("infrae-ui-dialog-resize",function(){resize()}),$dialog.dialog("open"),resize(!0)},ResizeDialog:function($dialog){$dialog.dialog("isOpen")&&$dialog.trigger("infrae-ui-dialog-resize")},ConfirmationDialog:function(data){var deferred=$.Deferred(),$message=$("<div></div>"),configuration={autoOpen:!1,modal:!0,buttons:{},zIndex:12e3};return data.title&&$message.attr("title",data.title),$message.html(data.message),data.buttons||(data.buttons={Cancel:function(){return!1},Continue:function(){return!0}},data.not_cancellable&&delete data.buttons.Cancel),$.each(data.buttons,function(name,callback){configuration.buttons[name]=function(){var result=callback();void 0!==result.then?result.then(deferred.resolve,deferred.reject):result?deferred.resolve():deferred.reject()}}),$message.bind("dialogclose",function(){$message.remove(),deferred.reject()}),deferred.always(function(){$message.dialog("close")}),$message.dialog(configuration),infrae.ui.ShowDialog($message),deferred.promise()},scroll:function($content,speed,direction,distance,interval){var target,position=$content.scrollTop();switch(direction){case"up":target=position-distance,interval&&(target-=target%interval);break;case"down":target=position+distance,interval&&0!=position%interval&&(target+=interval-target%interval);break;case"absolute":default:target=distance}return $content.stop(!0,!0),$content.animate({scrollTop:target},speed),$content.promise()},update_table_columns:function($table,options,$reference){return"object"!=typeof options.fixed&&(options.fixed={}),$table.each(function(){var $table=$(this),colComputedWidths={},fixedWidths={},totalWidth=0;if(void 0!==$reference){var regex=/([0-9]+)([em%]*)/;$reference.find("colgroup col").each(function(i){var match=$(this).attr("width").match(regex);match&&(colComputedWidths[i]=match[1],fixedWidths[i]=match[2])})}else $table.css("table-layout","auto"),$table.find("tr:visible:first td").each(function(i){options.fixed[i]?(colComputedWidths[i]=options.fixed[i],fixedWidths[i]=null):colComputedWidths[i]=$(this).outerWidth(),totalWidth+=colComputedWidths[i]});$table.css("table-layout","fixed"),$table.find("colgroup col").each(function(i){var newColWidth;void 0!==fixedWidths[i]?(newColWidth=colComputedWidths[i],fixedWidths[i]&&(newColWidth+=fixedWidths[i])):newColWidth=Math.round(100*(colComputedWidths[i]/totalWidth))+"%",$(this).attr("width",newColWidth)})})}}),infrae.ui=module})(infrae,jQuery);