(function($){function maybeCall(thing,ctx){return"function"==typeof thing?thing.call(ctx):thing}function Tipsy(element,options){this.$element=$(element),this.options=options,this.enabled=!0,this.fixTitle()}var getTip=function(){var $tip=$('<div class="tipsy"><div class="tipsy-arrow"></div><div class="tipsy-inner"></div></div>');return $("body").append($tip),getTip=function(){return $tip},$tip};Tipsy.prototype={show:function(){var title=this.getTitle();if(title&&this.enabled&&this.$element.is(":visible")){var $tip=getTip();$tip.find(".tipsy-inner")[this.options.html?"html":"text"](title),$tip[0].className="tipsy",$tip.css({top:0,left:0,visibility:"hidden",display:"block"});var tp,pos=$.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight,gravity=maybeCall(this.options.gravity,this.$element[0]);switch(gravity.charAt(0)){case"n":tp={top:pos.top+pos.height+this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case"s":tp={top:pos.top-actualHeight-this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case"e":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth-this.options.offset};break;case"w":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width+this.options.offset}}2==gravity.length&&(tp.left="w"==gravity.charAt(1)?pos.left+pos.width/2-15:pos.left+pos.width/2-actualWidth+15),$tip.css(tp).addClass("tipsy-"+gravity),$tip.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+gravity.charAt(0),this.options.className&&$tip.addClass(maybeCall(this.options.className,this.$element[0])),this.options.fade?$tip.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):$tip.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?getTip().stop().fadeOut():getTip().hide()},fixTitle:function(){var $e=this.$element;($e.attr("title")||"string"!=typeof $e.attr("original-title"))&&$e.attr("original-title",$e.attr("title")||"").removeAttr("title")},getTitle:function(){var title,$e=this.$element,o=this.options;return this.fixTitle(),"string"==typeof o.title?title=$e.attr("title"==o.title?"original-title":o.title):"function"==typeof o.title&&(title=o.title.call($e[0])),title=(""+title).replace(/(^\s*|\s*$)/,""),title||o.fallback},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},$.fn.tipsy=function(options){function get(ele){var tipsy=$.data(ele,"tipsy");return tipsy||(tipsy=new Tipsy(ele,$.fn.tipsy.elementOptions(ele,options)),$.data(ele,"tipsy",tipsy)),tipsy}function enter(){var tipsy=get(this);tipsy.hoverState="in",0==options.delayIn?tipsy.show():(tipsy.fixTitle(),setTimeout(function(){"in"==tipsy.hoverState&&tipsy.show()},options.delayIn))}function leave(){var tipsy=get(this);tipsy.hoverState="out",0==options.delayOut?tipsy.hide():setTimeout(function(){"out"==tipsy.hoverState&&tipsy.hide()},options.delayOut)}if(options===!0)return this.data("tipsy");if("string"==typeof options){var tipsy=this.data("tipsy");return tipsy&&tipsy[options](),this}if(options=$.extend({},$.fn.tipsy.defaults,options),this.each(function(){get(this)}),"manual"!=options.trigger){var eventIn="hover"==options.trigger?"mouseenter.tipsy":"focus.tipsy",eventOut="hover"==options.trigger?"mouseleave.tipsy":"blur.tipsy";null!==options.delegate?(this.delegate(options.delegate,eventIn,enter),this.delegate(options.delegate,eventOut,leave)):this.on(eventIn,enter).on(eventOut,leave)}return this},$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options},$.fn.tipsy.autoNS=function(){return $(this).offset().top>$(document).scrollTop()+$(window).height()/2?"s":"n"},$.fn.tipsy.autoWE=function(){return $(this).offset().left>$(document).scrollLeft()+$(window).width()/2?"e":"w"},$.fn.tipsy.autoBounds=function(margin,prefer){return function(){var dir={ns:prefer[0],ew:prefer.length>1?prefer[1]:!1},boundTop=$(document).scrollTop()+margin,boundLeft=$(document).scrollLeft()+margin,$this=$(this);return boundTop>$this.offset().top&&(dir.ns="n"),boundLeft>$this.offset().left&&(dir.ew="w"),margin>$(window).width()+$(document).scrollLeft()-$this.offset().left&&(dir.ew="e"),margin>$(window).height()+$(document).scrollTop()-$this.offset().top&&(dir.ns="s"),dir.ns+(dir.ew?dir.ew:"")}},$.fn.tipsy.defaults={className:null,delayIn:750,delayOut:0,fade:!1,fallback:"",gravity:$.fn.tipsy.autoBounds(100,"sw"),delegate:null,html:!1,offset:0,opacity:.8,title:"title",trigger:"hover"}})(jQuery);