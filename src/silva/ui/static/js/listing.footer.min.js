(function($,infrae){infrae.views.view({iface:"content",name:"clipboarditem.smilisting",factory:function($content,data,state){return{render:function(){var $item=$('<li class="clipboard-item '+state+'"></li>');if(data.title)if(data.path){var $link=$('<a class="open-screen"></a>');$link.attr("href",data.path),$link.text(data.title),$item.append($link)}else $item.text(data.title);if(data.icon){var $icon=$('<ins class="icon"></icon>');infrae.ui.icon($icon,data.icon),$item.prepend($icon)}$content.append($item)}}}});var render_clipboard=function($info,smi){var $popup=$info.children(".clipboard-content"),$detail=$info.children("a"),$icon=$detail.children("ins"),$count=$detail.children(".count"),is_uptodate=!1,update=function(){$popup.empty(),$.each(smi.clipboard.cutted,function(i,item){$popup.render({data:item,name:"clipboarditem.smilisting",args:["cutted"]})}),$.each(smi.clipboard.copied,function(i,item){$popup.render({data:item,name:"clipboarditem.smilisting",args:["copied"]})}),is_uptodate=!0},onchange=function(){var length=smi.clipboard.length();$count.text(""+length),$popup.is(":visible")?update():is_uptodate=!1,length?$icon.show():$icon.hide()};onchange(),$("body").bind("contentchange-smiclipboard",onchange);var toggle=function(){var is_visible=$popup.is(":visible"),is_unfoldable=$icon.is(":visible");is_uptodate||is_visible||update(),(is_visible||is_unfoldable)&&$popup.fadeToggle()};$detail.bind("click",function(){return toggle(),!1}),$popup.bind("mouseleave",function(){$popup.fadeOut()})},render_counters=function($counters,listing){listing.events.content(function(){for(var name in this){var $counter=$counters.find("."+name+" .count");$counter.text(""+this[name])}})};infrae.views.view({iface:"listing",name:"footer",factory:function($content,data,smi,listing){return{render:function(){infrae.ui.selection.disable($content),render_clipboard($content.find(".clipboard-info"),smi),render_counters($content.find(".counters"),listing),$content.children(".listing-footer-loading").hide(),$content.children(".listing-footer-content").show()}}}})})(jQuery,infrae);