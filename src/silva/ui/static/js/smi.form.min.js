(function(e,t){e.fn.invoke=function(){return Array.prototype.splice.call(arguments,0,1)[0].apply(this,arguments)};var n=function(n){if(!n.length)return;var r=n.position().top,i=n.outerHeight(),s=e(this),o,u;r<25?(o=s.scrollTop()-25+r,t.ui.scroll(s,"fast","absolute",o)):(u=s.innerHeight()-i-25,r>u&&(o=s.scrollTop()+(r-u),t.ui.scroll(s,"fast","absolute",o)))},r=function(){e(this).find(".form-section").removeClass("form-focus")},i=function(t,n){var i=t.closest(".form-section");if(i.is(".form-focus"))return;e(this).invoke(r),i.addClass("form-focus"),n||i.find(".field:first").focus()},s=function(){var t=e(this),r=t.find(".form-error:first").find(".field:first");r.length||(r=t.find(".field-required:first"),r.length||(r=t.find(".field:first"))),r.length&&(t.invoke(i,r),t.invoke(n,r.closest(".form-section")))},o=function(){var t=e(this),r=t.find(".form-focus"),s=r.next();if(!s.length){var o=r.closest(".form-body").nextAll(".form-body");if(o.length)s=o.find(".form-section:first");else{var u=r.closest("form").nextAll("form");u.length?s=u.find(".form-section:first"):s=t.find(".form-section:first")}}t.invoke(i,s),t.invoke(n,s)},u=function(){var t=e(this),r=t.find(".form-focus"),s=r.prev();if(!s.length){var o=r.closest(".form-body").prevAll(".form-body");if(o.length)s=o.find(".form-section:last");else{var u=r.closest("form").prevAll("form");u.length?s=u.find(".form-section:last"):s=t.find(".form-section:last")}}t.invoke(i,s),t.invoke(n,s)};e(".form-content").live("load-smiform",function(t,n){var r=n.container||e(this),o=n.form||r.find("form"),u=function(t){var n=e(t.target),s=n.closest(".form-section"),o=n.is("input")||n.is("a");r.invoke(i,s,o),o||t.stopPropagation()};r.delegate(".form-section","click",u),r.delegate(".form-section","focusin",u),r.delegate(".form-error-detail","click",function(){e(this).fadeOut().promise().done(function(){e(this).remove()})}),r.invoke(s),o.trigger("loadwidget-smiform",n)}),t.views.view({iface:"form",name:"content",factory:function(t,n,r){var i=null,s=e([]);return{template_data:!0,render:function(){if(n.portlets){var a=e('<div class="portlets form-content"></div>');i=e('<div class="forms form-content"></div>'),a.html(n.portlets),t.append(i),t.append(a)}else i=t,i.addClass("form-content");i.html(n.forms),s=i.find("form"),r.shortcuts.create("form",i,!0),s.each(function(){var t=e(this),n=t.attr("name"),s=function(e){var t=e.attr("data-confirmation");return t!==undefined?confirm(t):!0},o=function(n){if(!s(n))return!1;t.trigger("serialize-smiform",{form:t,container:i});var o=t.serializeArray(),u=!1;n!==undefined&&n.length&&(o.push({name:n.attr("name"),value:n.text()}),u=n.hasClass("link-control"));if(u){n.attr("href",[r.get_screen_url(),"?",e.param(o)].join(""));return}return r.ajax.send_to_opened(o),!1},u=function(){return o(t.find(".form-controls a.default-form-control"))};t.bind("submit",u),t.find(".form-controls a.form-control").each(function(){var t=e(this),n=t.attr("data-form-shortcut");t.bind("click",function(){return o(t)}),n&&r.shortcuts.bind("form",null,[n],function(){return o(t)})}),t.find(".form-controls a.form-button").each(function(){var t=e(this),n=t.attr("data-form-shortcut");n&&r.shortcuts.bind("form",null,[n],function(){return t.click(),!1})}),t.delegate(".form-controls a.form-popup","click",function(){var t=e(this);return t.SMIFormPopup().done(function(e){e.extra&&e.extra.refresh==n&&o()}),!1}),t.tipsy({delegate:"a.form-control"}),t.tipsy({delegate:"a.form-button"}),t.attr("data-form-url",r.get_screen_url())}),i.trigger("load-smiform",{form:s,container:i}),r.shortcuts.bind("form",null,["ctrl+down","ctrl+shift+down"],function(){return i.invoke(o),!1}),r.shortcuts.bind("form",null,["ctrl+up","ctrl+shift+up"],function(){return i.invoke(u),!1})},cleanup:function(){i!==null&&i.trigger("clean-smiform",{form:s,container:i}),r.shortcuts.remove("form"),t.undelegate(".form-section","focusin"),t.undelegate(".form-section","click"),t.removeClass("form-content"),t.empty()}}}})})(jQuery,infrae);