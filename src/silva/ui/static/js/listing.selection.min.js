(function(e,t){var n=function(n){var r=t.deferred.FluxCapacitor(),i=null,s=t.deferred.FluxCapacitor();return r.events.incoming(function(){e(this).addClass("selected")}),r.events.outgoing(function(){e(this).removeClass("selected")}),r.events.failing(function(){e(this).remove()}),s.events.incoming(function(){e(this).data("smilisting-line").rename()}),s.events.outgoing(function(){e(this).data("smilisting-line").update()}),{select:function(e){var t=!1;return e.length&&e.each(function(){t|=r.add(this)}),t},unselect:function(e){var t=!1;return e.each(function(){t|=r.remove(this)}),t},remove:function(e){var t=!1;return e.each(function(){t|=r.remove(this,!0)}),t},toggle:function(t){var n=!1;return t.each(function(){e(this).hasClass("selected")?n|=r.remove(this):n|=r.add(this)}),n},rename:function(t){return i===null?(i=t,r.events.push(),r.events.incoming(function(){s.add(this)}),r.events.failing(r.events.outgoing(function(){s.remove(this,!0)})),r.events.outgoing(function(){e(this).data("smilisting-line").update()}),!0):!1},collect:function(t){if(i!==null){var n=i.promise();if(t){var o=s.map(function(){return e(this).data("smilisting-line").values(["identifier","title"])});r.events.pop(),s.clear(),i.resolve(o)}else r.events.pop(),s.clear(!1),i.reject();return i=null,n}return null},status:function(){var t=[],n=[];return r.each(function(){var r=e(this);if(!r.is(":visible"))return;var i=r.data("smilisting");for(var s=0;s<i.ifaces.length;s++)e.inArray(i.ifaces[s],t)<0&&t.push(i.ifaces[s]);n.push(i)}),{ifaces:t,selection:{length:n.length,items:n},input:{status:i!=null}}}}};t.smi.listing.Selection=n})(jQuery,infrae);