(function($,infrae){var Selection=function(){var selection=infrae.deferred.FluxCapacitor(),renaming=null,renames=infrae.deferred.FluxCapacitor();return selection.events.incoming(function(){$(this).addClass("selected")}),selection.events.outgoing(function(){$(this).removeClass("selected")}),selection.events.failing(function(){$(this).remove()}),renames.events.incoming(function(){$(this).data("smilisting-line").rename()}),renames.events.outgoing(function(){$(this).data("smilisting-line").update()}),{select:function($items){var changed=!1;return $items.length&&$items.each(function(){changed|=selection.add(this)}),changed},unselect:function($items){var changed=!1;return $items.each(function(){changed|=selection.remove(this)}),changed},remove:function($items){var changed=!1;return $items.each(function(){changed|=selection.remove(this,!0)}),changed},toggle:function($items){var changed=!1;return $items.each(function(){changed|=$(this).hasClass("selected")?selection.remove(this):selection.add(this)}),changed},rename:function(deferred){return null===renaming?(renaming=deferred,selection.events.push(),selection.events.incoming(function(){renames.add(this)}),selection.events.failing(selection.events.outgoing(function(){renames.remove(this,!0)})),selection.events.outgoing(function(){$(this).data("smilisting-line").update()}),!0):!1},collect:function(success){if(null!==renaming){var promise=renaming.promise();if(success){var values=renames.map(function(){return $(this).data("smilisting-line").values(["identifier","title"])});selection.events.pop(),renames.clear(),renaming.resolve(values)}else selection.events.pop(),renames.clear(!1),renaming.reject();return renaming=null,promise}return null},status:function(){var ifaces=[],data=[];return selection.each(function(){var $item=$(this);if($item.is(":visible")){for(var local_data=$item.data("smilisting"),e=0;local_data.ifaces.length>e;e++)0>$.inArray(local_data.ifaces[e],ifaces)&&ifaces.push(local_data.ifaces[e]);data.push(local_data)}}),{ifaces:ifaces,selection:{length:data.length,items:data},input:{status:null!=renaming}}}}};infrae.smi.listing.Selection=Selection})(jQuery,infrae);