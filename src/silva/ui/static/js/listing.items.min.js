(function(e,t,n){var r=function(e,t,n){var r=e.children("ins.ui-icon"),i=function(){r.hasClass("ui-icon-triangle-1-e")?(r.removeClass("ui-icon-triangle-1-e"),r.addClass("ui-icon-triangle-1-s")):(r.removeClass("ui-icon-triangle-1-s"),r.addClass("ui-icon-triangle-1-e"))},s=function(){n.collapsed=!n.collapsed,i(),e.toggleClass("collapsed"),t.toggleClass("collapsed"),e.trigger("collapsingchange-smilisting")};n.collapsed&&(i(),e.addClass("collapsed"),t.addClass("collapsed"),e.trigger("collapsingchange-smilisting")),e.bind("click",function(e){return s(),!1})},i=function(t,n,r){var i=null;t.tableDnD({dragHandle:"moveable",onDragClass:"moving",onAllowDrop:function(t,n){return e(n).data("smilisting").moveable!=0},onDragStart:function(t){if(n.hasClass("filtering"))return!1;i=e(t).parent("tr").index(),n.trigger("resetselection-smilisting"),n.removeClass("static")},onDrop:function(s){var o=e(s),u=o.index(),a=o.data("smilisting");u!=i?(u>i&&(i-=1),t.children("tr.item:first").data("smilisting").moveable||(u-=1),r([{name:"content",value:a.id},{name:"position",value:u}]).then(function(e){return e||(u<i&&(i-=1),o.detach(),o.insertAfter(t.children("tr.item:eq("+i+")"))),n.addClass("static"),e})):n.addClass("static")}})};t.views.view({iface:"listing-items",name:"listing-container",factory:function(n,s,o,u){var a=function(e,t,n){if(n>-1){var r=u.$container.children().eq(n);r.length?r.before(e):u.$container.append(e)}else u.$container.append(e)},f=function(n){var r=e('<tr class="item"></tr>'),i={};r.attr("id","list"+n.id.toString());var s=function(n){var i=e("<td></td>");n.view&&(i.bind("refreshcell-smilisting",function(r,i){var s=e(this),o=null;n.name&&(o=i[n.name]),t.smi.listing.columns.render(s,{data:i,name:n.view,ifaces:["object"],args:[n,o]}),r.stopPropagation(),r.preventDefault()}),n.name!==undefined&&n.renameable!==undefined&&(i.addClass("renameable"),i.bind("renamecell-smilisting",function(r,i){r.stopPropagation(),r.preventDefault();if(n.renameable.item_match!==undefined&&!t.utils.test(i,n.renameable.item_match))return;var s=e(this),o=e('<input class="renaming" type="text" />');o.attr("name",n.name),o.val(i[n.name]),s.empty(),s.append(o)}))),r.append(i)};return t.utils.each(o.columns,s),e.extend(i,{update:function(t){if(t!=undefined){r.data("smilisting",t);if(t.position>-1){var n=t.position,i=u.$container.children("tr.item:first");i.length&&i.data("smilisting").moveable&&(n-=1),n>0&&u.$container.children().index(r)!=n&&(r.detach(),a(r,t,n))}}else t=r.data("smilisting");r.children().each(function(){e(this).triggerHandler("refreshcell-smilisting",t)})},rename:function(){var t=r.data("smilisting");r.find("td.renameable").each(function(){e(this).triggerHandler("renamecell-smilisting",t)})},values:function(){var t=r.find("input.renaming");if(!t.length)return undefined;var n=r.data("smilisting"),i={id:n.id};return t.each(function(){var t=e(this);i[t.attr("name")]=t.val()}),i}}),i.update(n),r.data("smilisting-line",i),a(r,n,n.position),r.get(0)};return e.extend(u,{title:o.title,add:function(t,n){var r=e.Deferred();return t.length?(n||u.$table.children(".empty").remove(),u.$table.prepend("<colgroup>"+Array(o.columns.length+1).join("<col></col>")+"</colgroup>"),this.add=function(e){return u.worker.add(e,f)},u.add(t)):(n&&u.$table.append('<tr class="empty"><td colpsan="'+o.columns.length+'">There is no items here.</td></tr>'),r.resolve([]),r.promise())},$container:null,$table:null}),e.extend({template_append:!0,jsont:'<dt class="ui-state-default"><ins class="ui-icon ui-icon-triangle-1-s"></ins>{title}</dt><dd><table class="static"><tbody></tbody></table></dd>',render:function(e){return u.$table=e.find("table"),u.$container=u.$table.find("tbody"),r(e.filter("dt"),e.filter("dd"),o),u.sort&&i(u.$container,u.$table,u.sort),u.add(s.items,!0)}},u)}})})(jQuery,infrae,jsontemplate);